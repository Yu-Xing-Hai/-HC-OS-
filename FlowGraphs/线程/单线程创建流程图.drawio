<mxfile host="65bd71144e">
    <diagram id="XVHUciTLL9wrwaslb7kZ" name="Page-1">
        <mxGraphModel dx="9414" dy="3133" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="39" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="2" target="25">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="2" value="【main.c】 //注意！main函数是内核入口&lt;br&gt;void k_thread_a(void*);&amp;nbsp; //声明一个目标函数，该函数将被作为参数传入线程创建函数中&lt;br&gt;&lt;br&gt;int main(void) {&lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//创建新线程&lt;br&gt;&lt;span style=&quot;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;thread_start(&quot;k_thread_a&quot;, 31, k_thread_a, &quot;argA &quot;);&lt;br&gt;&lt;br&gt;&lt;span style=&quot;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;while(1);&lt;br&gt;&lt;span style=&quot;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;return 0;&lt;br&gt;}&lt;br&gt;&lt;br&gt;void k_thread_a(void* arg) {&amp;nbsp; //在线程中运行的函数实例&lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;void* 表示通用参数，&lt;/span&gt;该&lt;span style=&quot;white-space: pre;&quot;&gt;函数接受通用参数后自行转换&#x9;&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;char* para = arg;&lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;while(1) {&lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;put_str(para);&lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;}&lt;br&gt;&lt;br&gt;}" style="rounded=1;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="1058.5" y="350" width="323" height="340" as="geometry"/>
                </mxCell>
                <mxCell id="35" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="25" target="26">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="36" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="25" target="27">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="25" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;【thread.c】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*The entry of creating thread: create an thread which priority is prio,name is name.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; task_struct&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;thread_start&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;char*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; name&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; prio&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; thread_func function&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; func_arg&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; task_struct&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; thread &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;get_kernel_pages&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//use one page to create an PCB&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;init_thread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(thread, name, prio);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; //initialize PCB by base information&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;thread_create&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(thread, function, func_arg);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; //initialize thread_stack in PCB&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*Pay attention: we use general_tag to represent PCB in thread_ready_list*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;!&lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;elem_find&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;thread_ready_list, &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;thread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;general_tag&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;));&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;list_append&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;thread_ready_list, &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;thread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;general_tag&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;elem_find&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;thread_ready_list, &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;thread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;general_tag&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;));&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; //locate the mistake&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;!&lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;elem_find&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;thread_all_list, &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;thread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;all_list_tag&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;));&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;list_append&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;thread_all_list, &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;thread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;all_list_tag&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; thread;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="860" y="800" width="720" height="300" as="geometry"/>
                </mxCell>
                <mxCell id="26" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;【thread。c】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*initialize the base information of thread.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;you can say initialize PCB*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;init_thread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; task_struct&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; pthread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;char*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; name&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; prio&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; /*&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142); background-color: light-dark(rgb(35, 39, 46), rgb(201, 204, 210));&quot;&gt;the value of sizeof(*pthread) is just a structure&#39;s size of &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142); background-color: light-dark(rgb(35, 39, 46), rgb(201, 204, 210));&quot;&gt;    task_struct instead of a page&#39;s size, so don&#39;t warry about return address.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;    memset&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(pthread, &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;sizeof&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;pthread));&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;pthread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;pid&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;allocate_pid&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;();&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;pthread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;self_kstack&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)((&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)pthread &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; PG_SIZE);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(pthread &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; main_thread) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;pthread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;status&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; TASK_RUNNING;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;else&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;pthread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;status&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; TASK_READY;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;strcpy&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;pthread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, name);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;pthread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;priority&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; prio;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;pthread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;ticks&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; prio;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;pthread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;elapsed_ticks&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;pthread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;pgdir&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;pthread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;stack_magic&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;0x&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;12345678&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="540" y="1200" width="620" height="430" as="geometry"/>
                </mxCell>
                <mxCell id="38" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="27" target="37">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="27" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;【thread.c】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*initlalize thread_stack*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;thread_create&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; task_struct&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; pthread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; thread_func&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; function&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; func_arg&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; //task_struct: struct of PCB&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; /*reserved space of intr_stack*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;pthread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;self_kstack&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;-=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;sizeof&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; intr_stack);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; /*reserved space of thread_stack*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;pthread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;self_kstack&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;-=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;sizeof&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; thread_stack);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;    //at this time, self_kstack(also is kthread_stack) is pointed to the structure of thread_stack.&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; thread_stack&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; kthread_stack &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; thread_stack&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;pthread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;self_kstack&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;kthread_stack&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;eip&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; kernel_thread;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;kthread_stack&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;function&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; function;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;kthread_stack&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;func_arg&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; func_arg;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;kthread_stack&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;ebp&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;kthread_stack&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;ebx&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;kthread_stack&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;esi&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;kthread_stack&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;edi&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1310" y="1200" width="910" height="280" as="geometry"/>
                </mxCell>
                <mxCell id="34" style="edgeStyle=none;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="28" target="27">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="28" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;【thread.h】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*thread stack*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;thread_stack&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; ebp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; ebx;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; edi;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; esi;&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*When thread first run,eip point to kernel_thread(), other time, eip point to the return address of suitch_to().*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; (*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;eip&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;thread_func&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;func&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;func_arg&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//&quot;eip&quot; is just a parameter name.&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;unused_retaddr);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//placeholding&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; thread_func&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; function;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; func_arg;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2360" y="1490" width="885" height="290" as="geometry"/>
                </mxCell>
                <mxCell id="31" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="30" target="26">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="30" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;【thread.h】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*process or thread&#39;s PCB(program control block)*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;task_struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; self_kstack;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;pid_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; pid;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;enum&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;task_status&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;status&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;16&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; priority;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; ticks;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//the piece of time (task running in CPU), one clock interrupt occured, ticks--.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; elapsed_ticks;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; //elapsed: have used.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;list_elem&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;general_tag&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;list_elem&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;all_list_tag&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; pgdir;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//task is process, pgdir is the address of PDT, task is thread, pgdir is NULL.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;virtual_addr&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;userprog_vaddr&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//each users&#39; viarual address pool manager.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;mem_block_desc&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;u_block_descs&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[DESC_CNT];&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//memory block descriptor for user-process, to aceieve heap-managing.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; stack_magic;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//the boundary of stack,clock interrupt function will judge this value.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="-550" y="1240" width="930" height="350" as="geometry"/>
                </mxCell>
                <mxCell id="33" style="edgeStyle=none;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="32" target="27">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="32" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;【thread.h】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*This structure is used to store environment of process or thread when interrupt occured.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;intr_stack&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; {&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//just define this structure, operating system can use this space arbitrarily.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; vec_no;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//vector number&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; edi;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; esi;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; ebp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; esp_dummy;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; //popad will igonre esp.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; ebx;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; edx;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; ecx;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; eax;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; gs;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; fs;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; es;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; ds;&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; /*Sitiuation: when interrupt occured, the privilige level has changed*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; err_code;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; (*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;eip&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) (&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; cs;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; eflags;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; esp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; ss;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2422.5" y="820" width="760" height="480" as="geometry"/>
                </mxCell>
                <mxCell id="37" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;【thread.c】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;kernel_thread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;thread_func&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; function&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; func_arg&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; /*after enter interrupt, CPU will close interrupt automatically,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; but our task&#39;s schedule is based on clock interrupt,so we need enable interrupt.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;intr_enable&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;();&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//set IF bit to 1,CPU begin to receive clock interrupt.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;function&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(func_arg);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1440" y="1555" width="650" height="160" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>