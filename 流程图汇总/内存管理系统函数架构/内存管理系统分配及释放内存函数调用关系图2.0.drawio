<mxfile host="65bd71144e">
    <diagram id="ZWqLPD2WmsHp29wwZ1Tq" name="Page-1">
        <mxGraphModel dx="4947" dy="588" grid="1" gridSize="10" guides="0" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" background="none" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="11" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="5" target="6" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="12" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" target="7" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1130" y="270" as="sourcePoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="5" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;【main.c】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;u_prog_a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; addr1 &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;malloc&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;256&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; addr2 &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;malloc&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;255&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; addr3 &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;malloc&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;254&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;printf&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot; prog_a malloc addr:0x&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;%x&lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;, 0x&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;%x&lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;, 0x&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;%x&lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, (&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)addr1, (&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)addr2, (&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)addr3);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; cpu_delay &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;100000&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;while&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(cpu_delay&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;--&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;free&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(addr1);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;free&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(addr2);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;free&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(addr3);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;while&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="450" width="690" height="270" as="geometry"/>
                </mxCell>
                <mxCell id="13" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="6" target="8" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="6" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;【syscall.c】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;malloc&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; size&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;_syscall1&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(SYS_MALLOC, size);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-415" y="330" width="360" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="14" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="7" target="8" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1130" y="515" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="7" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;【syscall.c&lt;/span&gt;&lt;span style=&quot;background-color: light-dark(rgb(35, 39, 46), rgb(201, 204, 210));&quot;&gt;】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;free&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; ptr&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;_syscall1&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(SYS_FREE, ptr);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1635" y="330" width="230" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="34" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="8" target="19" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="35" style="edgeStyle=none;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="8" target="18" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="460" y="585" as="sourcePoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="8" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;【syscall.c】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*The syscall of One-parameter*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;#define&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;_syscall1&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;NUMBER&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;ARG1&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) ({ &lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;\&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; retval; &lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;\&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;asm&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;volatile&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;int $0x80&lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; : &lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;=a&lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(retval) : &lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(NUMBER), &lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;b&lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(ARG1) : &lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;memory&lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;); &lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;\&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; retval; &lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;\&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;})&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="472.5" y="515" width="645" height="140" as="geometry"/>
                </mxCell>
                <mxCell id="33" style="edgeStyle=none;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="9" target="32" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="9" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;【memory.c】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*Apply memory of &#39;size&#39; size in heap.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;sys_malloc&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; size&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;//Preparation&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;enum&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; pool_flags PF;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; pool&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; mem_pool;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; pool_size;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; mem_block_desc&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; descs;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; task_struct&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; cur_thread &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;running_thread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;();&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; /*Judge to use whcih physic memory-pool.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;cur_thread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;pgdir&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//kernel thread&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; PF &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; PF_KERNEL;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; pool_size &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;kernel_pool&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;pool_size&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mem_pool &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;kernel_pool;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; descs &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; k_block_descs;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;else&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; {&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//user process&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; PF &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; PF_USER;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; pool_size &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;user_pool&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;pool_size&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mem_pool &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;user_pool;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; descs &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;cur_thread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;u_block_descs&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;!&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(size &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; size &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; pool_size)) {&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//size must be in the range of (0, pool_size).&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; arena&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; a;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; mem_block&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; b;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;lock_acquire&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;mem_pool&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;lock&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*Condition One: The size of applying is more than 1024*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(size &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;1024&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; page_cnt &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;DIV_ROUND_UP&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(size &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;sizeof&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; arena), PG_SIZE);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//page_cnt is the number of page which we need to apply.&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; a &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;malloc_page&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(PF, page_cnt);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//apply page.&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(a &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;!=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;memset&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(a, &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, page_cnt &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; PG_SIZE);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//clean this memory space which you have applied.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*For large page frame, the desc is NULL, and large is true, the cnt is the number of page frame.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;desc&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;cnt&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; page_cnt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;large&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;lock_release&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;mem_pool&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;lock&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)(a &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//skip the size of arena return the remainder memory.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;else&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;lock_release&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;mem_pool&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;lock&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*Condition Two: The size of applying is less than 1024*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;else&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; desc_idx;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*Match the suitable size of memory block in memory-block-descriptor.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;for&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(desc_idx &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;; desc_idx &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; DESC_CNT; desc_idx&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;++&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//The parameter of desc_idx will be changed.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(size &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;lt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;descs&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[desc_idx].&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;block_size&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*if mem_block_desc&#39;s free_list don&#39;t have mem_block to use, then, create new arena to provide mem_block.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;list_empty&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;descs&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[desc_idx].&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;free_list&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; a &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;malloc_page&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(PF, &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//apply page from virtual memory pool to be new arena.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(a &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;lock_release&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;mem_pool&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;lock&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;memset&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(a, &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, PG_SIZE);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*For little memory block, the desc is the corresponding mem_block_desc, and large is false, the cnt is the number of blocks in one arena.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;desc&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;descs&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[desc_idx];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;large&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;cnt&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;descs&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[desc_idx].&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;blocks_per_arena&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; block_idx; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;enum&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; intr_status old_status &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;intr_disable&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;();&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*Begin to split the arena to little mem_block, and add them to free_list in mem_block_desc.*/&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;for&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(block_idx &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;; block_idx &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;descs&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[desc_idx].&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;blocks_per_arena&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;; block_idx&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;++&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; b &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;arena2block&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(a, block_idx);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;!&lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;elem_find&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;desc&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;free_list&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;b&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;free_elem&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;));&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;list_append&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;desc&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;free_list&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;b&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;free_elem&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;intr_set_status&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(old_status);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*Begin to distribute mem_block.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*Get one memory block from free_list in mem_block_desc.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; b &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;elem2entry&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; mem_block, free_elem, &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;list_pop&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;descs&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[desc_idx].&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;free_list&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)));&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;memset&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(b, &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;descs&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[desc_idx].&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;block_size&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; a &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;block2arena&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(b);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp; //Get the arena which has the block of &#39;b&#39;.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;cnt&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;--&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//The number of free memory block in this arena will decrease one.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;lock_release&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;mem_pool&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;lock&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)b;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-780" y="840" width="1085" height="1830" as="geometry"/>
                </mxCell>
                <mxCell id="40" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="10" target="39" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="10" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;【memory.c】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*Recycle the memory which is pointed by ptr*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;sys_free&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; ptr&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(ptr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;!=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(ptr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;!=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;enum&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; pool_flags PF;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; pool&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; mem_pool;&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*Judge whether is thread or process.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;running_thread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;()-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;pgdir&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//kernel thread&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)ptr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; K_HEAP_START);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; PF &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; PF_KERNEL;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mem_pool &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;kernel_pool;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;else&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; {&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//user process&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; PF &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; PF_USER;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mem_pool &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;user_pool;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;lock_acquire&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;mem_pool&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;lock&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; mem_block&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; b &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; ptr;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; arena&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; a &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;block2arena&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(b);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;large&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;||&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;large&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;desc&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;large&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//large memory block(more than 1024Byte)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;mfree_page&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(PF, a, &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;cnt&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;else&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; {&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//little memory block(less than 1024Byte)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*First: Add the memory block to free_list in mem_block_desc.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;list_append&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;desc&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;free_list&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;b&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;free_elem&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;cnt&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;++&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*Second: If all memory block in this arena are free, then, release this arena.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;cnt&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;desc&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;blocks_per_arena&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//it means all memory block in this arena are free.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; block_idx;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;for&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(block_idx &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;; block_idx &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;desc&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;blocks_per_arena&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;; block_idx&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;++&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; mem_block&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; b &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;arena2block&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(a, block_idx);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;elem_find&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;desc&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;free_list&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;b&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;free_elem&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;));&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;list_remove&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;b&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;free_elem&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;mfree_page&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(PF, a, &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//release this arena.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;lock_release&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;mem_pool&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;lock&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1340" y="840" width="820" height="880" as="geometry"/>
                </mxCell>
                <mxCell id="41" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="18" target="9" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="18" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;【syscall-init.c】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;syscall_table&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[SYS_MALLOC] &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; sys_malloc;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-390" y="560" width="310" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="42" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="19" target="10" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="19" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;【syscall-init.c】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;syscall_table&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[SYS_FREE] &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; sys_free;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1615" y="560" width="270" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="26" style="edgeStyle=none;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0;entryDx=0;entryDy=0;" parent="1" source="22" target="9" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="27" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" parent="1" source="22" target="10" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1600.0000000000018" y="955" as="sourcePoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="22" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;【memeory.h】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*Memory block*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;mem_block&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;list_elem&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;free_elem&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*Memory block descriptor*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;mem_block_desc&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; block_size;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//size of memory block&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; blocks_per_arena;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//number of memory block in ONE arena&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;list&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;free_list&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//free list of memory block&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="530" y="840" width="530" height="240" as="geometry"/>
                </mxCell>
                <mxCell id="29" style="edgeStyle=none;html=1;exitX=0;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=0;entryDx=0;entryDy=0;" parent="1" source="28" target="9" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="30" style="edgeStyle=none;html=1;exitX=1;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" parent="1" source="28" target="10" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1690.0000000000018" y="1152.5" as="sourcePoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="31" style="edgeStyle=none;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="1" source="28" target="22" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="28" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;【memory.c】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*Memory warehouse*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;In the future, we will give more than one page frame to one arena&#39;s struct-pointer, &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;and it&#39;s Yuan information will use 12Byte to record.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; arena {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; mem_block_desc&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; desc;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//This arena belongs to which memory block descriptor.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; cnt;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*large = false: The number of free memory block in this arena, &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;large = true: The number of page frame, we will use it when we free the memory in future.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;bool&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; large;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="440" y="1152.5" width="710" height="255" as="geometry"/>
                </mxCell>
                <mxCell id="32" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;【memory.c】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*destribute page space and the quantities are pg_cnt.If success,return start virtual address,else return NULL.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;malloc_page&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;enum&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; pool_flags pf&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; pg_cnt&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(pg_cnt &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; pg_cnt &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;3840&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//3840： kernel or user pyhsic space have about 16MB,we use 15MB to limit. pg_cnt &amp;lt; 15 * 1024 * 1024 / 4096(PG_SIZE) = 3840 (page)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*************************the principle of malloc_page()***************************/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/* &amp;nbsp; &amp;nbsp; &amp;nbsp;First: use vaddr_get() to apply vaitual address from virtual memory pool.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Second: use palloc() to apply physic page from physic memory pool.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Thired: use page_table_add() to finish mapping from virtual address to physic address in PT.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; vaddr_start &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;vaddr_get&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(pf, pg_cnt);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(vaddr_start &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; vaddr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)vaddr_start, cnt &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; pg_cnt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; pool&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; mem_pool &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; pf &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; PF_KERNEL &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;?&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;kernel_pool &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;user_pool;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//make sure to use which type of pool to destribute physic page,this pointer(mem_pool) point to pool structure.&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; /*virtual address is continuous,but physic address could not be continuous,so we divide these three function from one cycle,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; and we can apply more virtual page onetime instead of applying virtual page one by one,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; if we failed to apply virtual page,we can decrease steps to apply physic page.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;while&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(cnt&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;--&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; page_phyaddr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;palloc&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(mem_pool);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(page_phyaddr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;//if failed, we must rollback all address(virtual/physic page) which are applied, we will achieve it in the future.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;page_table_add&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)vaddr, page_phyaddr);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//make mapping in PT.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; vaddr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;+=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; PG_SIZE;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp; &amp;nbsp;//next virtual page.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; vaddr_start;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-2520" y="1455" width="1420" height="600" as="geometry"/>
                </mxCell>
                <mxCell id="37" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="36" target="10" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="38" style="edgeStyle=none;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.25;entryDx=0;entryDy=0;" parent="1" source="36" target="9" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="36" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;【memory.c】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*Return the address of &#39;NO. idx&#39; memory block from arena*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; mem_block&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;arena2block&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; arena&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; idx&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; mem_block&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)((&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)a &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;sizeof&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; arena) &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; idx &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;desc&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;block_size&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*Return the address of arena which has the block of &#39;b&#39;*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; arena&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;block2arena&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; mem_block&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; b&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; arena&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)((&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)b &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;0x&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;fffff000&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp; //arena&#39;s unit is page(4KB).&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="425" y="1540" width="740" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="39" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;【memory.c】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*Encapsulation: Remove physic page frame*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;mfree_page&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;enum&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; pool_flags pf&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; _vaddr&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; pg_cnt&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; pg_phy_addr;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; vaddr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)_vaddr, page_cnt &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(pg_cnt &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; vaddr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; PG_SIZE &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; pg_phy_addr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;addr_v2p&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(vaddr);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//get the physic address of vaddr.&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; /*Make sure the physic address which will be released is at low-1MB + 1KB PDT + 1KB PT outside.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;((pg_phy_addr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; PG_SIZE) &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; pg_phy_addr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;0x&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;102000&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(pg_phy_addr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;user_pool&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;phy_addr_start&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//User&#39;s physic memory pool.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; vaddr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;-=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; PG_SIZE;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;while&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(page_cnt &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; pg_cnt) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; vaddr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;+=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; PG_SIZE;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; pg_phy_addr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;addr_v2p&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(vaddr);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;((pg_phy_addr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; PG_SIZE) &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; pg_phy_addr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;user_pool&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;phy_addr_start&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*First: Recycle the physic address of pg_phy_addr to physic memory pool.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;pfree&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(pg_phy_addr);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*Second: Cancle the mapping from PTE to physic address in PT(don&#39;t change PDE)*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;page_table_pte_remove&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(vaddr);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; page_cnt&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;++&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*Third: Remove virtual address*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;vaddr_remove&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(pf, _vaddr, pg_cnt);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;else&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; {&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//Kernel&#39;s physic memory pool.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; vaddr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;-=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; PG_SIZE;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;while&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(page_cnt &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; pg_cnt) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; vaddr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;+=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; PG_SIZE;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; pg_phy_addr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;addr_v2p&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(vaddr);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;((pg_phy_addr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; PG_SIZE) &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; pg_phy_addr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;kernel_pool&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;phy_addr_start&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; pg_phy_addr &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;user_pool&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;phy_addr_start&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*First: Recycle the physic address of pg_phy_addr to physic memory pool.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;pfree&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(pg_phy_addr);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*Second: Cancle the mapping from PTE to physic address in PT(don&#39;t change PDE)*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;page_table_pte_remove&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(vaddr);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; page_cnt&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;++&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*Third: Remove virtual address*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;vaddr_remove&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(pf, _vaddr, pg_cnt);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="2420" y="830" width="1060" height="900" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>