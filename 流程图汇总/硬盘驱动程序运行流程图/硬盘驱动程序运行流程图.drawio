<mxfile host="65bd71144e">
    <diagram id="NXoIKHi7fJ2mxSvgdCLZ" name="Page-1">
        <mxGraphModel dx="6868" dy="1975" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="827" pageHeight="1169" background="none" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="56" style="edgeStyle=none;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="96" target="10" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="-1018" y="595"/>
                        </Array>
                        <mxPoint x="360" y="595" as="sourcePoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="58" style="edgeStyle=none;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;exitX=0;exitY=0.25;exitDx=0;exitDy=0;" parent="1" source="96" target="5" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="394" y="282" as="sourcePoint"/>
                        <mxPoint x="167" y="282" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="92" style="edgeStyle=none;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.75;exitDx=0;exitDy=0;" edge="1" parent="1" source="96" target="46">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1450" y="893" as="sourcePoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="4" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;【ide.h】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*The structure of ata Channel*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;ide_channel&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;8&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;];&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//IDE channel name,such as ata0\ide0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint16_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; port_base;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//The base address of port in this channel.,such as 0x1F0 is the base port of channel 1.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; irq_no;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//Different interrupt number indicate the different channel.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;lock&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;lock&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//Make sure that intr_handler know which disk give the signal.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;bool&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; expecting_intr;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//True: this channel is waitting for disk&#39;s interrupt.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;semaphore&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;disk_done&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//The semaphore of the channel, used to block or wake up the drive-program.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;disk&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;devices&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;];&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//The two devices of the channel(master and slave)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-366" y="-395" width="870" height="220" as="geometry"/>
                </mxCell>
                <mxCell id="5" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;【stdio.c】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;sprintf&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;char*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; buf&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;char*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; format&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; ...&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//&#39;...&#39; means that the number of arguments is uncertain.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; va_list args;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; retval;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;va_start&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(args, format);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; retval &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;vsprintf&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(buf, format, args);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;va_end&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(args);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; retval;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-709" y="195" width="860" height="180" as="geometry"/>
                </mxCell>
                <mxCell id="6" value="&lt;div style=&quot;color: #abb2bf;background-color: #23272e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;/*The structure of Disk*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;disk&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;8&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;ide_channel&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;my_channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; dev_no;&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//Master is 0, Slave is 1.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;partition&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;prim_parts&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;4&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;];&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//The main partition&#39;s number is 4.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;partition&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;logic_parts&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;8&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;];&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//The logic partition&#39;s number is 8.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="634" y="-339" width="560" height="164" as="geometry"/>
                </mxCell>
                <mxCell id="7" value="&lt;div style=&quot;color: #abb2bf;background-color: #23272e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;/*The strcuture of Partition*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;partition&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; start_lba;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; sec_cnt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;disk&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;my_disk&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//The disk which the partition belongs to.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;list_elem&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;part_tag&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//The tag of this partition(used in queue)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;8&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;];&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//The name of the partition&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;super_block&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;sb&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//We define that one sector is one block.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;bitmap&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;block_bitmap&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//The bitmap which is used to manage the block.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;bitmap&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;inode_bitmap&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;list&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;open_inodes&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1353" y="-420" width="630" height="270" as="geometry"/>
                </mxCell>
                <mxCell id="9" style="edgeStyle=none;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="8" target="7" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="8" value="&lt;div style=&quot;color: #abb2bf;background-color: #23272e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;/*define the structure of list element*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;list_elem&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;list_elem&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;prev&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//preview node&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;list_elem&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;next&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//next node&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="2062" y="-345" width="360" height="120" as="geometry"/>
                </mxCell>
                <mxCell id="57" style="edgeStyle=none;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;" parent="1" source="10" target="30" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="60" style="edgeStyle=none;html=1;exitX=0;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="10" target="11">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="61" style="edgeStyle=none;html=1;exitX=0;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="10" target="19">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="64" style="edgeStyle=none;html=1;exitX=0;exitY=0.25;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="10" target="38">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="65" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="10" target="40">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="72" style="edgeStyle=none;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="10" target="71">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="10" value="&lt;div style=&quot;color: #abb2bf;background-color: #23272e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;/*Get the disk&#39;s parameters information*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;identify_disk&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; disk&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;id_info&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;512&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;];&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//Store the information which return from identify commend.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;select_disk&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(hd);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;cmd_out&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;my_channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, CMD_IDENTIFY);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;sema_down&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;my_channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;disk_done&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #56b6c2;&quot;&gt;!&lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;busy_wait&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(hd)) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;error&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;64&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;sprintf&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(error, &lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;%s&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt; identify failed!!!&lt;/span&gt;&lt;span style=&quot;color: #56b6c2;&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;PANIC&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(error);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;read_from_sector&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(hd, id_info, &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;buf&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;64&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;];&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//Used by swap_pairs_bytes(), store the translated answer.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; sn_start &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;10&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, sn_len &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;20&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, md_start &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;27&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, md_len &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;40&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;swap_pairs_bytes&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;id_info&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;[sn_start], buf, sn_len);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;printk&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot; &amp;nbsp;disk &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;%s&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt; info:&lt;/span&gt;&lt;span style=&quot;color: #56b6c2;&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt; &amp;nbsp; &amp;nbsp;SN: &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;%s&lt;/span&gt;&lt;span style=&quot;color: #56b6c2;&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, buf);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;memset&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(buf, &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;sizeof&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(buf));&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;swap_pairs_bytes&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;id_info&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;[md_start], buf, md_len);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;printk&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot; &amp;nbsp; &amp;nbsp;MODULE: &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;%s&lt;/span&gt;&lt;span style=&quot;color: #56b6c2;&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, buf);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; sectors &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint32_t*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;id_info&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;60&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;printf&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot; &amp;nbsp; &amp;nbsp;SECTORS: &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;%d&lt;/span&gt;&lt;span style=&quot;color: #56b6c2;&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, sectors);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;printk&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot; &amp;nbsp; &amp;nbsp;CAPACITY: &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;%d&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;MB&lt;/span&gt;&lt;span style=&quot;color: #56b6c2;&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, sectors &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;512&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;1024&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;1024&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-1333" y="872" width="640" height="578" as="geometry"/>
                </mxCell>
                <mxCell id="11" value="&lt;div style=&quot;color: #abb2bf;background-color: #23272e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;/*Select the disk to read or write*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;select_disk&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; disk&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; reg_device &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; BIT_DEV_MBS &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;|&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; BIT_DEV_LBA;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;dev_no&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; reg_device &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;|=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; BIT_DEV_DEV;&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//if the device is slave, the bit is 1.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;outb&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;reg_dev&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;my_channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;), reg_device);&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//Finsh the selection of disk.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-2151" y="791" width="600" height="160" as="geometry"/>
                </mxCell>
                <mxCell id="15" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="12" target="11" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="12" value="&lt;div style=&quot;color: #abb2bf;background-color: #23272e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;#define&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;reg_dev&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) (&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;port_base&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;6&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-2056" y="741" width="410" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="14" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" target="11" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-2231" y="871" as="sourcePoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="13" value="&lt;div style=&quot;color: #abb2bf;background-color: #23272e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;/*&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;First function: outb()&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;function: &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;&amp;nbsp; &amp;nbsp;write one byte to port.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;parameters:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;&amp;nbsp; &amp;nbsp;uint16_t: the type of unsigned int and it&#39;s 16bit value.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;inline&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;outb&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint16_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;port&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;data&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;asm&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;volatile&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;outb %b0, %w1&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; : : &lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(data), &lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;Nd&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(port));&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; //The parameter of &quot;N&quot; indicate that the port number is between 0 and 255.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-3281" y="768.5" width="1040" height="205" as="geometry"/>
                </mxCell>
                <mxCell id="63" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="19" target="28">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="19" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*Push commend to channel*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;cmd_out&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; ide_channel&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; channel&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; cmd&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; channel&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;expecting_intr&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;outb&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;reg_cmd&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(channel), cmd);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-2041" y="1125" width="490" height="109.5" as="geometry"/>
                </mxCell>
                <mxCell id="62" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="24" target="19">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="24" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;#define&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;CMD_IDENTIFY&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;0x&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;ec&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-1894.5" y="1066" width="197" height="29.5" as="geometry"/>
                </mxCell>
                <mxCell id="26" value="&lt;div style=&quot;color: #abb2bf;background-color: #23272e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;#define&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;reg_cmd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;reg_status&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;(channel)&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-1967.25" y="1283" width="342.5" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="28" value="&lt;div style=&quot;color: #abb2bf;background-color: #23272e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;#define&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;reg_status&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) (&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;port_base&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;7&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-1998.5" y="1263" width="405" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="66" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="30" target="32">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="30" value="&lt;div style=&quot;color: #abb2bf;background-color: #23272e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;/*Delay 30s, yield the CPU*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;bool&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;busy_wait&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; disk&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; ide_channel&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; channel &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;my_channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint16_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; time_limit &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;30&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;1000&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;while&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(time_limit &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;-=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;10&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #56b6c2;&quot;&gt;!&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;inb&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;reg_status&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(channel)) &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; BIT_ALT_STAT_BSY)) {&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//bit is 1, the disk is busy.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;inb&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;reg_status&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(channel)) &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; BIT_ALT_STAT_DRQ);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;else&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;mtime_sleep&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;10&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//Sleep 10ms&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-533" y="949" width="700" height="272" as="geometry"/>
                </mxCell>
                <mxCell id="67" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="32" target="34">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="32" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;【timer.c&lt;/span&gt;&lt;span style=&quot;background-color: light-dark(rgb(35, 39, 46), rgb(201, 204, 210));&quot;&gt;】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;background-color: light-dark(rgb(35, 39, 46), rgb(201, 204, 210));&quot;&gt;*&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;function: delay the process for m_seconds&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;1s = 1000ms, ms : millisecond&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;mtime_sleep&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; m_seconds&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; sleep_ticks &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;DIV_ROUND_UP&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(m_seconds, mil_seconds_per_intr);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//convert time to the number of tick.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(sleep_ticks &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;ticks_to_sleep&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(sleep_ticks);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-613" y="1290" width="860" height="199" as="geometry"/>
                </mxCell>
                <mxCell id="68" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="34" target="36">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="34" value="&lt;div style=&quot;color: #abb2bf;background-color: #23272e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;/*Make task sleep, purppose is to delay*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;ticks_to_sleep&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; sleep_ticks&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; start_tick &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; ticks;&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//ticks: global parameter&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;while&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(ticks &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; start_tick &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; sleep_ticks) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;thread_yield&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;();&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//Yield the CPU to other threads&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-410.5" y="1548" width="455" height="160" as="geometry"/>
                </mxCell>
                <mxCell id="36" value="&lt;div style=&quot;background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre; color: rgb(171, 178, 191);&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#7f848e&quot;&gt;【thread.c】&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*Yield the cpu, change other thread to running.*/&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;thread_yield&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; task_struct&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; cur &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;running_thread&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;();&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;enum&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; intr_status old_status &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;intr_disable&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;();&lt;/span&gt;&lt;/div&gt;&lt;font color=&quot;rgba(0, 0, 0, 0)&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;!&lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;elem_find&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;thread_ready_list, &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;cur&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;general_tag&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;));&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;list_append&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;thread_ready_list, &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;cur&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;general_tag&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;cur&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;status&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; TASK_READY;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;schedule&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;();&lt;/span&gt;&lt;/div&gt;&lt;font color=&quot;rgba(0, 0, 0, 0)&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;intr_set_status&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(old_status);&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-423" y="1768" width="480" height="260" as="geometry"/>
                </mxCell>
                <mxCell id="38" value="&lt;div style=&quot;color: #abb2bf;background-color: #23272e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;/*The handler of disk&#39;s interrupt*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;intr_hd_handler&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; irq_no&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(irq_no &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;0x&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;2e&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #56b6c2;&quot;&gt;||&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; irq_no &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;0x&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;2f&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; channel_no &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; irq_no &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;0x&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;2e&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; ide_channel&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; channel &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;channels&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;[ch_no];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;irq_no&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; irq_no);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;expecting_intr&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;expecting_intr&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;sema_up&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;disk_done&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*If read status register, the disk&#39;s controler will make sure this interrupt has be processd.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;inb&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;reg_status&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(channel));&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-2351" y="1380" width="800" height="290" as="geometry"/>
                </mxCell>
                <mxCell id="70" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="40" target="69">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="40" value="&lt;div style=&quot;background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre; color: rgb(171, 178, 191);&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#7f848e&quot;&gt;【ide.c】&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*Writ from disk to buffer*/&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;read_from_sector&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; disk&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; hd&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; buf&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; sec_cnt&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; size_in_byte;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(sec_cnt &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; size_in_byte &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;256&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;512&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;else&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; {&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; size_in_byte &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; sec_cnt &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;512&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;insw&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;reg_data&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;my_channel&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;), buf, size_in_byte &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-1303" y="1504" width="580" height="230" as="geometry"/>
                </mxCell>
                <mxCell id="77" style="edgeStyle=none;html=1;exitX=1;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="46" target="52">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="81" style="edgeStyle=none;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="46" target="53">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="3772" y="703"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="46" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*Scan the patitions in sector which address is ext_lba*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;partition_scan&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; disk&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; hd&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; ext_lba&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; boot_sector&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; bs &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;sys_malloc&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;sizeof&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; boot_sector));&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;ide_read&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(hd, ext_lba, bs, &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; part_idx &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; partition_table_entry&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; p &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;bs&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;partition_table&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; /*Traverse patition table entries*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;while&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(part_idx++ &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;4&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;fs_type&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;0x&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;5&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//If the file system&#39;s type is extend patition&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(ext_lba_base &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;!=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;partition_scan&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(hd, &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;start_lba&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; ext_lba_base);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//The start_lba of Sub-extend-patition is the offset by address of total-extend-patition.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;else&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; {&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//p is pointed the total-extend-patition-table-entry in sector which is include MBR.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ext_lba_base &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;start_lba&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//Total-extend-patition&#39;s start address.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;partition_scan&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(hd, &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;start_lba&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;else&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;fs_type&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;!=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//The patition&#39;s type is effective.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(ext_lba &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//Not is extend, so, is primary patition.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;prim_parts&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[p_no].&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;start_lba&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; ext_lba &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;start_lba&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;prim_parts&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[p_no].&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;sec_cnt&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;sec_cnt&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;prim_parts&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[p_no].&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;my_disk&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; hd;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;list_append&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;partition_list, &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;prim_parts&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[p_no].&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;part_tag&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;sprintf&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;prim_parts&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[p_no].&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;%s%d&lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, p_no &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; p_no&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;++&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(p_no &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;4&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;else&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;logic_parts&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[l_no].&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;start_lba&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; ext_lba &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;start_lba&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;logic_parts&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[l_no].&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;sec_cnt&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;sec_cnt&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;logic_parts&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[l_no].&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;my_disk&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; hd;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;list_append&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;partition_list, &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;logic_parts&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[l_no].&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;part_tag&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;sprintf&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;logic_parts&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[l_no].&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;%s%d&lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, l_no &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;5&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; l_no&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;++&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(l_no &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;8&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; p&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;++&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;sys_free&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(bs);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1743" y="493" width="1200" height="840" as="geometry"/>
                </mxCell>
                <mxCell id="52" value="&lt;div style=&quot;color: #abb2bf;background-color: #23272e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;/*Bootloader sector(Which include MBR or EBR)*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; boot_sector {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;other&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;446&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;];&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//The program code of bootloader(just to Placeholding)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; partition_table_entry &lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;partition_table&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;4&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;];&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//The partition table entry, totally have 64Byte(4 entry * 16Byte)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint16_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; signature;&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//The end signature of the boot sector, 0x55AA&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;} &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;__attribute__&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;packed&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;));&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="3207" y="432" width="920" height="121" as="geometry"/>
                </mxCell>
                <mxCell id="83" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="53" target="82">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="53" value="&lt;div style=&quot;color: #abb2bf;background-color: #23272e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;/*Encapsulation_1: Read the number of sec_cnt data from dask to buffer*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;ide_read&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; disk&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; lba&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; buf&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; sec_cnt&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(lba &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;lt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; max_lba);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(sec_cnt &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;lock_acquire&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;my_channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;lock&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;&amp;nbsp; &amp;nbsp; /*First: select disk*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;select_disk&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(hd);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;&amp;nbsp; &amp;nbsp; /*Second: Push the sector&#39;s number which will be wanted to read or write and LBA address to port.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; secs_op;&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//The number of sectors which will be read or write in one operation.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; secs_done &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//The number of sectors which have been read or write.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;while&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(secs_done &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; sec_cnt) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;((secs_done &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;256&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;lt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; sec_cnt) {&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//Special: sec_cnt = 0.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; secs_op &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;256&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;else&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; secs_op &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; sec_cnt &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; secs_done;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;select_sector&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(hd, lba &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; secs_done, secs_op);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*Third: Push commend to reg_cmd register*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;cmd_out&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;my_channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, CMD_READ_SECTOR);&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//Ready to read data.&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*Forth: The disk start to busy, so,we block current process, when disk finish it&#39;s work, it will use interrupt to wake up this process.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;sema_down&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;my_channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;disk_done&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*Fifth: Check the disk&#39;s state to make sure whether the disk could be read.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #56b6c2;&quot;&gt;!&lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;busy_wait&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(hd)) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;error&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;64&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;sprintf&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(error, &lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;%s&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt; read sector &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;%d&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt; failed!!!&lt;/span&gt;&lt;span style=&quot;color: #56b6c2;&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, lba);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;PANIC&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(error);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*Sixth: Read data from disk to buffer.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;read_from_sector&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(hd, (&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;)((&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;)buf &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; secs_done &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;512&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;), secs_op);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; secs_done &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;+=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; secs_op;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;lock_release&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;my_channle&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;lock&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="3207" y="741" width="1130" height="765" as="geometry"/>
                </mxCell>
                <mxCell id="59" value="" style="shape=singleArrow;direction=south;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="884" y="-143" width="60" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="69" value="&lt;div style=&quot;color: #abb2bf;background-color: #23272e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;/*&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;Forth fuction: insw()&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;function: &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;&amp;nbsp; &amp;nbsp;read more byte from port.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;parameters:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;&amp;nbsp; &amp;nbsp;D: edi/di&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;&amp;nbsp; &amp;nbsp;&quot;memory&quot;: we notice gcc that we changed memory.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;directives:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;&amp;nbsp; &amp;nbsp;insw(assembly language): read 16bit data from port to address which is pointed by es:edi.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;inline&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;insw&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint16_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;port&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;void*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;addr&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;word_cnt&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;asm&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;volatile&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;cld; rep insw&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; : &lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;+D&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(addr), &lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;+c&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(word_cnt) : &lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;d&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(port) : &lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;memory&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="-1368" y="1817" width="710" height="254" as="geometry"/>
                </mxCell>
                <mxCell id="71" value="&lt;div style=&quot;color: #abb2bf;background-color: #23272e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;swap_pairs_bytes&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;char*&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; dst&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;char*&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; buf&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; len&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; idx;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;for&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(idx &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;; idx &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; len; idx &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;+=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;buf&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;[idx &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;] &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;dst&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;++&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;buf&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;[idx] &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;dst&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;++&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;buf&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;[idx] &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color: #56b6c2;&quot;&gt;\0&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="-2101" y="1776" width="550" height="158" as="geometry"/>
                </mxCell>
                <mxCell id="75" value="Yu Xinghai" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" vertex="1" parent="1">
                    <mxGeometry x="848.75" y="-658" width="130.5" height="261" as="geometry"/>
                </mxCell>
                <mxCell id="82" value="&lt;div style=&quot;color: #abb2bf;background-color: #23272e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;/*Push the LBA and sector&#39;s number to ports*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;select_sector&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; disk&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; lba&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; sec_cnt&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(lba &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;lt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; max_lba);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; ide_channel&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; channel &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;my_channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;&amp;nbsp; &amp;nbsp; /*Push the sector&#39;s number which will be wanted to read or write to port.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;outb&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;reg_sect_cnt&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(channel), sec_cnt);&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//if the sector&#39;s number is 0, it means 256 sectors.&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;&amp;nbsp; &amp;nbsp; /*Push the LBA address to port*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;outb&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;reg_lba_l&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(channel), lba);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;outb&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;reg_lba_m&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(channel), lba &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;8&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;outb&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;reg_lba_h&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(channel), lba &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;16&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;&amp;nbsp; &amp;nbsp; /*LBA&#39;s bit is 0~27, so, we use register of device to store LBA&#39;s 24~27bit by using 0~3 of device register.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;outb&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;reg_dev&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(channel), BIT_DEV_MBS &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;|&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; BIT_DEV_LBA &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;|&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;dev_no&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;?&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; BIT_DEV_DEV &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;|&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; lba &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;24&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="4439" y="966.6500000000001" width="870.64" height="313.7" as="geometry"/>
                </mxCell>
                <mxCell id="84" value="&lt;font style=&quot;font-size: 48px;&quot;&gt;Begin!!!&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
                    <mxGeometry x="990" y="-712" width="198" height="115" as="geometry"/>
                </mxCell>
                <mxCell id="85" value="&lt;font color=&quot;#ff6666&quot; style=&quot;font-size: 48px;&quot;&gt;重看的代码(分析的不详细)&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
                    <mxGeometry x="2029.5" y="394" width="627" height="112" as="geometry"/>
                </mxCell>
                <mxCell id="93" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="86" target="89">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="86" value="&lt;div style=&quot;color: rgb(171, 178, 191); background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;【list.c】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*find an element which is eligible*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; list_elem&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;list_traversal&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; list&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; plist&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; function func&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt; arg&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; list_elem&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; elem &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;plist&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;head&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;next&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;list_empty&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(plist)) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;while&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(elem &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;!=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;plist&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;tail&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;func&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(elem, arg)) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; elem;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; elem &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;elem&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;next&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="614.4999999999998" y="1338" width="599" height="311" as="geometry"/>
                </mxCell>
                <mxCell id="89" value="&lt;div style=&quot;color: #abb2bf;background-color: #23272e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;/*Print th information of patition*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;bool&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;partition_info&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; list_elem&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; pelem&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt; arg&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;UNUSED&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(arg);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; partition&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; part &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;elem2entry&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; partition, part_tag, pelem);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;printk&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;%s&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt; start_lba:0x&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;%x&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;, sec_cnt:0x&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;%x&lt;/span&gt;&lt;span style=&quot;color: #56b6c2;&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;part&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;part&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;start_lba&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;part&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;sec_cnt&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="549.19" y="1757.58" width="729.63" height="156.58" as="geometry"/>
                </mxCell>
                <mxCell id="99" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="96" target="86">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <UserObject label="&lt;div style=&quot;background-color: rgb(35, 39, 46); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre; color: rgb(171, 178, 191);&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#7f848e&quot;&gt;【ide.c】&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;/*Initialize the disk&#39;s structure*/&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;ide_init&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;() {&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;printk&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;ide_init start&lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;font color=&quot;rgba(0, 0, 0, 0)&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; hd_cnt &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint8_t*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;0x&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;475&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;));&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//Get the number of hard disk&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(hd_cnt &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; channel_cnt &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;DIV_ROUND_UP&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(hd_cnt, &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//One channel has two disks&lt;/span&gt;&lt;/div&gt;&lt;font color=&quot;rgba(0, 0, 0, 0)&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; ide_channel&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; channel;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; channel_no &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; dev_no &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;font color=&quot;rgba(0, 0, 0, 0)&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; /*Process channel and each channel&#39;s disk.*/&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;while&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(channel_no &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; channel_cnt) {&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; channel &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;channels&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[channel_no];&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;sprintf&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;ide&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;%d&lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, channel_no);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//Write the channel&#39;s name to channel-&amp;gt;name.&lt;/span&gt;&lt;/div&gt;&lt;font color=&quot;rgba(0, 0, 0, 0)&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*Initialize port base address and interrupt vector for each ide channel*/&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;switch&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; (channel_no) {&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;case&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;port_base&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;0x&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;1f0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;irq_no&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;0x&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;20&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;14&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;case&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;port_base&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;0x&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;170&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;irq_no&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;0x&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;20&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;15&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//Interrupt number is 0x2f, it mapping The last pin in 8259A&#39;s slaver piece.&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;font color=&quot;rgba(0, 0, 0, 0)&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;register_handler&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;irq_no&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, intr_hd_handler);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//Register the handler in idt_table&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;expecting_intr&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//It is false when we don&#39;t write commend to disk.&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;lock_init&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;lock&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//Initialize the lock of the channel&lt;/span&gt;&lt;/div&gt;&lt;font color=&quot;rgba(0, 0, 0, 0)&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*Used to block or wake up the process.*/&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;sema_init&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;disk_done&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//Initialize the semaphore of the channel, the initial value is 1.&lt;/span&gt;&lt;/div&gt;&lt;font color=&quot;rgba(0, 0, 0, 0)&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;list_init&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;partition_list);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//The author is forget to initialize the partition_list, so, we initialize it here.&lt;/span&gt;&lt;/div&gt;&lt;font color=&quot;rgba(0, 0, 0, 0)&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*Process all disk in each channel*/&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;while&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(dev_no &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; disk&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; hd &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;devices&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;[dev_no];&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;my_channel&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; channel;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;dev_no&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; dev_no;&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//Master is 0 and is slaver 1&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;sprintf&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(224, 108, 117);&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;sd&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;%c&lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&#39;a&#39;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; channel_no &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; dev_no);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//Write the disk&#39;s name to disk-&amp;gt;name.&lt;/span&gt;&lt;/div&gt;&lt;font color=&quot;rgba(0, 0, 0, 0)&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;identify_disk&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(hd);&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//Get the disk&#39;s parameters&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(dev_no &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;!=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;) {&lt;/span&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt; &amp;nbsp;//we just have two disk, hd60M.img(sda) and hd80M.img(sdb),and hd60M.img(sda) don&#39;t have patitions.&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;partition_scan&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(hd, &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; p_no &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;, l_no &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; dev_no&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;++&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; dev_no &lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;font color=&quot;rgba(0, 0, 0, 0)&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; channel_no&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;++&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;font color=&quot;rgba(0, 0, 0, 0)&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;printk&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt; &amp;nbsp;all partition info&lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;font color=&quot;rgba(0, 0, 0, 0)&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(127, 132, 142);&quot;&gt;&amp;nbsp; &amp;nbsp; /*Print all partition&#39;s information*/&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;list_traversal&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;partition_list, partition_info, (&lt;/span&gt;&lt;span style=&quot;color: rgb(198, 120, 221);&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;printk&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;ide_init done&lt;/span&gt;&lt;span style=&quot;color: rgb(86, 182, 194);&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color: rgb(152, 195, 121);&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: light-dark(rgb(171, 178, 191), rgb(79, 85, 96));&quot;&gt;&lt;span style=&quot;color: rgb(171, 178, 191);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" link="&lt;div style=&quot;color: #abb2bf;background-color: #23272e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;/*Initialize the disk&#39;s structure*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;ide_init&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;() {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;printk&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;ide_init start&lt;/span&gt;&lt;span style=&quot;color: #56b6c2;&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; hd_cnt &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint8_t*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;0x&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;475&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;));&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//Get the number of hard disk&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;ASSERT&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(hd_cnt &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; channel_cnt &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;DIV_ROUND_UP&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(hd_cnt, &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//One channel has two disks&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; ide_channel&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; channel;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; channel_no &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; dev_no &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;&amp;nbsp; &amp;nbsp; /*Process channel and each channel&#39;s disk.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;while&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(channel_no &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; channel_cnt) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; channel &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;channels&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;[channel_no];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;sprintf&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;ide&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;%d&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, channel_no);&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//Write the channel&#39;s name to channel-&amp;gt;name.&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*Initialize port base address and interrupt vector for each ide channel*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;switch&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; (channel_no) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;case&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;port_base&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;0x&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;1f0&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;irq_no&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;0x&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;20&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;14&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;case&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;port_base&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;0x&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;170&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;irq_no&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;0x&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;20&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;15&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//Interrupt number is 0x2f, it mapping The last pin in 8259A&#39;s slaver piece.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;register_handler&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;irq_no&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, intr_hd_handler);&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//Register the handler in idt_table&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;expecting_intr&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//It is false when we don&#39;t write commend to disk.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;lock_init&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;lock&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//Initialize the lock of the channel&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*Used to block or wake up the process.*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;sema_init&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;disk_done&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//Initialize the semaphore of the channel, the initial value is 1.&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;list_init&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;partition_list);&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//The author is forget to initialize the partition_list, so, we initialize it here.&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*Process all disk in each channel*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;while&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(dev_no &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; disk&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; hd &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;devices&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;[dev_no];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;my_channel&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; channel;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;dev_no&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; dev_no;&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//Master is 0 and is slaver 1&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;sprintf&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #e5c07b;&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #e06c75;&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;sd&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;%c&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&#39;a&#39;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; channel_no &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; dev_no);&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//Write the disk&#39;s name to disk-&amp;gt;name.&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;identify_disk&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(hd);&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//Get the disk&#39;s parameters&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(dev_no &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;!=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;) {&lt;/span&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt; &amp;nbsp;//we just have two disk, hd60M.img(sda) and hd80M.img(sdb),and hd60M.img(sda) don&#39;t have patitions.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;partition_scan&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(hd, &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; p_no &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;, l_no &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; dev_no&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;++&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; dev_no &lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; channel_no&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;++&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;printk&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #56b6c2;&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt; &amp;nbsp;all partition info&lt;/span&gt;&lt;span style=&quot;color: #56b6c2;&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #7f848e;&quot;&gt;&amp;nbsp; &amp;nbsp; /*Print all partition&#39;s information*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;list_traversal&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;partition_list, partition_info, (&lt;/span&gt;&lt;span style=&quot;color: #c678dd;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #d19a66;&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #61afef;&quot;&gt;printk&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;ide_init done&lt;/span&gt;&lt;span style=&quot;color: #56b6c2;&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color: #98c379;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #abb2bf;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" id="96">
                    <mxCell style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                        <mxGeometry x="412.62" y="-29.000000000000057" width="1002.76" height="1257" as="geometry"/>
                    </mxCell>
                </UserObject>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>